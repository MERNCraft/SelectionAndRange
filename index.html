<!DOCTYPE html>
<html lang="en">
<head>
  <title>getSelection</title>
  <style>
    body {
      color: #ddd;
      background-color: #111;
    }
    div#image {
      text-align: center;
      img {
        vertical-align: middle;
      }
      &::before {
        content: "::before\00a0\00a0";
      }
      &::after {
        content: "\00a0\00a0::after"
      }
    }
    input {
      margin: 1em 0;
      width: 100%;
    }
    pre {
      background-color: #333;
      min-height: 1em;
      margin-top: 0;
      white-space: pre-wrap;
    }
    pre,
    .feedback {
      -webkit-user-select: none;
      user-select: none;

      & span {
        display: inline-block;
        font-family: monospace;
        text-decoration: underline;
        width: 100%;
        text-align: center;
      }
    }
  </style>
</head>
<body>
  <p id="one">Click and drag       to make a selection üëçüèº</p>
  <p id="two">Your selection can <i>start</i> on one line and <i>end</i><b></b><span> on another.</span></p>
  <div id="image">
    <img
      src="https://picsum.photos/48/48"
      alt="random image from https://picsum.photos/48/48"
    >
  </div>
  <input type="text" placeholder="text input">
  <div class="feedback">
    <span>selection.toString()</span>
    <pre id="selection"></pre>
  </div>
  <div class="feedback">
    <span>selection.getRangeAt(0)</span>
    <pre id="range"></pre>
  </div>

  <script>
    let ii = 0
    const selectionP = document.getElementById("selection")
    const rangeP = document.getElementById("range")

    const selection = window.getSelection()

    setInterval(showSelection, 100)

    function showSelection() {
      if (!selection.rangeCount) {
        selectionP.innerText = "selection.rangeCount: 0"
        rangeP.innerText = ""
        return
      }

      const range = selection.getRangeAt(0)

      const start = range.startContainer
      const startName = start.nodeName
      let startParent = range.startContainer.parentElement
      let id = startParent.id
      startParent = startParent.tagName.toLowerCase()
                  + (id ? `#${id}` : "")

      const end = range.endContainer
      const endName = end.nodeName
      let endParent = range.endContainer.parentElement
      id = endParent.id
      endParent = endParent.tagName.toLowerCase()
                + (id ? `#${id}` : "")

      selectionP.innerText = selection

      rangeP.innerText =
`range.startContainer.nodeName:      ${startName}
range.startContainer.parentElement: ${startParent}
range.startOffset:                  ${range.startOffset}

range.endContainer.nodeName:        ${endName}
range.endContainer.parentElement:   ${endParent}
range.endOffset:                    ${range.endOffset}`
    }
  </script>
</body>
</html>